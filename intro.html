<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Introduction &mdash; ochopod 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/flasky.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="ochopod 1.0 documentation" href="index.html" />
    <link rel="next" title="Concepts" href="concepts.html" />
    <link rel="prev" title="Overview" href="index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">
  
  

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="concepts.html" title="Concepts"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Overview"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">ochopod 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h1>
<div class="section" id="problem-statement">
<h2>Problem statement<a class="headerlink" href="#problem-statement" title="Permalink to this headline">¶</a></h2>
<p>You are building some cool distributed backend and since you&#8217;re at the bleeding edge you decided to use <a class="reference external" href="https://www.docker.com/">Docker</a>
containers. Even better you decided to be even cooler and run atop a <a class="reference external" href="http://mesos.apache.org/">Mesos</a> or <a class="reference external" href="https://github.com/GoogleCloudPlatform/kubernetes">Kubernetes</a> stack.</p>
<p>You now have plenty of containers floating around on multiple nodes and using all kinds of random ports and IPs.</p>
<p>How do you manage them? How do you solve annoying cross-container configuration issues? How do you identify issues
and peek at logs? How do you reconnect your CI/CD pipeline with this?</p>
<p>No need to pull you hair anymore, simply use Ochopod!</p>
</div>
<div class="section" id="mesos-marathon-ochopod">
<h2>Mesos, Marathon &amp; Ochopod<a class="headerlink" href="#mesos-marathon-ochopod" title="Permalink to this headline">¶</a></h2>
<p>Without getting too much into details system like <a class="reference external" href="https://github.com/GoogleCloudPlatform/kubernetes">Kubernetes</a> or <a class="reference external" href="http://mesos.apache.org/">Mesos</a> will manage <a class="reference external" href="https://www.docker.com/">Docker</a> containers for you. What
you do is run some <em>high level construct</em> (a <em>replication controller</em> on <a class="reference external" href="https://github.com/GoogleCloudPlatform/kubernetes">Kubernetes</a> for instance) : you specify an
image, environment variables, constraints plus a number of instances and the stack will look for available resources.
It will then ask the <a class="reference external" href="https://www.docker.com/">Docker</a> daemon on those resources to run your image appropriately.</p>
<p>By embedding and invoking Ochopod in your <a class="reference external" href="https://www.docker.com/">Docker</a> image you will run an init-like system in your container which will
do 3 things :</p>
<ol class="arabic simple">
<li><strong>Synchronize automatically</strong> with all other containers spawned by your application (e.g your peers).</li>
<li><strong>Spawn the sub-process of your choice</strong> and restart it in case of unexpected failure.</li>
<li>Let you query or <strong>remote-control your containers</strong> from a CI/CD pipeline or any other tool you wish to build.</li>
</ol>
<p>Your <em>Dockerfile</em> specifies what needs to be installed in your container while your script defines what process needs
to be started and how to configure it across multiple instances.</p>
<p>This allows you to efficiently coordinate multiple containers to form for instance a <a class="reference external" href="http://zookeeper.apache.org">Zookeeper</a> ensemble or a
<a class="reference external" href="http://cassandra.apache.org/">Cassandra</a> ring in a nice automatic way. More interestingly you can also express transitive dependencies between your
clusters, e.g your set of <a class="reference external" href="http://kafka.apache.org/">Kafka</a> brokers will only configure when their underlying <a class="reference external" href="http://zookeeper.apache.org">zookeeper</a> ensemble is up and
running with more than 3 nodes. Finding out where the pods run and what ports they expose is all taken care of for you.</p>
</div>
<div class="section" id="getting-started">
<h2>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<div class="section" id="try-it-out-locally">
<h3>Try it out locally<a class="headerlink" href="#try-it-out-locally" title="Permalink to this headline">¶</a></h3>
<p>Simply run a local <a class="reference external" href="http://zookeeper.apache.org">Zookeeper</a> server on your workstation. Then install the SDK and run the little <a class="reference external" href="https://github.com/autodesk-cloud/ochopod/blob/master/examples/shell.py">shell</a> example:</p>
<div class="code python highlight-python"><div class="highlight"><pre>$ cd ochopod-python-sdk/sdk
$ python setup.py install
$ python ../examples/shell.py
INFO - EC2 marathon bindings started
INFO - running in local mode (make sure you run a standalone zookeeper)
INFO - starting marathon.local (marathon/ec2) @ local
...
</pre></div>
</div>
<p>This pod will terminate after around 5 seconds and runs a trivial bash statement. You can tweak the code and
experiment. Try turning your <a class="reference external" href="http://zookeeper.apache.org">Zookeeper</a> server on/off and you&#8217;ll see the pod re-connecting automatically.</p>
</div>
<div class="section" id="a-real-zookeeper-ensemble-over-kubernetes">
<h3>A real Zookeeper ensemble over Kubernetes !<a class="headerlink" href="#a-real-zookeeper-ensemble-over-kubernetes" title="Permalink to this headline">¶</a></h3>
<p>It&#8217;s now time to do something a bit more realistic. Go peek at the <a class="reference external" href="https://github.com/autodesk-cloud/ochonetes/tree/master/images/zookeeper">container</a> we use as an example in another of our
projects. Build and either push it to your hub account or private repository or build the image on each node within
your cluster if you prefer. This container is a small example of how to run a containerized <a class="reference external" href="http://zookeeper.apache.org">Zookeeper</a> ensemble over
<a class="reference external" href="https://github.com/GoogleCloudPlatform/kubernetes">Kubernetes</a>. Feel free to explore the code and see how it is done.</p>
<p>OK, you have your new image and are now ready to spawn a <em>replication controller</em>. Since we&#8217;re running <a class="reference external" href="http://zookeeper.apache.org">Zookeeper</a> make
sure to expose ports 2181, 2888 and 3888. Also expose 8080 since this is our control port (e.g the port used by the
pods to communicate). Be bold and go for at least 3 instances. For instance:</p>
<div class="code yaml highlight-python"><div class="highlight"><pre>kind: ReplicationController
apiVersion: v1beta3
metadata:
  name: zk
spec:
  replicas: 3
  selector:
    name: zk
  template:
    metadata:
      labels:
        name: zk
    spec:
      containers:
      - name: zookeper
        image: paugamo/k8s-ec2-zookeeper
        env:
          - name:   ochopod_cluster
            value:  ensemble

        ports:
            - containerPort: 2181
            - containerPort: 2888
            - containerPort: 3888
            - containerPort: 8080
</pre></div>
</div>
<p>You&#8217;ll notice we pass <em>ochopod_cluster</em> down to the container. This will tell Ochopod to assemble all those pods into
one single cluster called <em>ensemble</em>. Please note the corresponding controller will be named differently (which is
fine).</p>
<p>Once your containers are running wait a few seconds for the cluster to form and stabilize. You can then test out your
newly formed ensemble by sending a <em>MNTR</em> command to any pod on TCP 2181. You should get a well-formed response telling
you the remote server is indeed up and part of a ensemble.</p>
<p>That&#8217;s pretty much it. Now scale your controller up. You&#8217;ll again get a functional ensemble (larger this time) after a
few seconds! Woa now that is cool.</p>
<p>I picked <a class="reference external" href="http://zookeeper.apache.org">Zookeeper</a> as it&#8217;s a classic case giving dev/ops engineers nightmares. Swap it for any system requiring
either a sequenced bootstrap (usually <a class="reference external" href="http://en.wikipedia.org/wiki/Gossip_protocol">Gossip</a> based system or <a class="reference external" href="http://www.rabbitmq.com/">RabbitMQ</a> for instance) or some level of global
knowledge prior to configuring its nodes and you will then realize how much Ochopod can help you.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/autodesk-logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Introduction</a><ul>
<li><a class="reference internal" href="#problem-statement">Problem statement</a></li>
<li><a class="reference internal" href="#mesos-marathon-ochopod">Mesos, Marathon &amp; Ochopod</a></li>
<li><a class="reference internal" href="#getting-started">Getting started</a><ul>
<li><a class="reference internal" href="#try-it-out-locally">Try it out locally</a></li>
<li><a class="reference internal" href="#a-real-zookeeper-ensemble-over-kubernetes">A real Zookeeper ensemble over Kubernetes !</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Overview</a></li>
      <li>Next: <a href="concepts.html" title="next chapter">Concepts</a></li>
  </ul></li>
</ul>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer">
    &copy; Copyright 2015, Autodesk.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  
  </body>
</html>